<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁôªÂΩï - SecureBank</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #0f172a;
            --bg-card: #1e293b;
            --bg-input: #0f172a;
            --border: #334155;
            --primary: #3b82f6;
            --primary-hover: #2563eb;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text);
        }

        .container {
            width: 100%;
            max-width: 420px;
            padding: 2rem;
        }

        /* Login Card */
        .login-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .logo-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-subtitle {
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        h2 {
            text-align: center;
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            color: var(--text);
        }

        /* Form */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .input-wrapper {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        .form-input {
            width: 100%;
            padding: 0.875rem 1rem 0.875rem 2.75rem;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        /* Checkbox */
        .form-checkbox {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .checkbox-wrapper input {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
            cursor: pointer;
        }

        .checkbox-label {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .forgot-link {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.875rem;
        }

        .forgot-link:hover {
            text-decoration: underline;
        }

        /* Button */
        .btn-login {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--primary), #2563eb);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-login:active {
            transform: translateY(0);
        }

        /* Divider */
        .divider {
            display: flex;
            align-items: center;
            margin: 1.5rem 0;
        }

        .divider-line {
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        .divider-text {
            padding: 0 1rem;
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        /* Social Login */
        .social-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn-social {
            flex: 1;
            padding: 0.75rem;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-social:hover {
            background: var(--border);
            transform: translateY(-2px);
        }

        /* Register Link */
        .register-link {
            text-align: center;
            margin-top: 1.5rem;
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .register-link a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        .register-link a:hover {
            text-decoration: underline;
        }

        /* ==================== Source Monitor Panel ==================== */
        .monitor-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            z-index: 1000;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .monitor-toggle:hover {
            transform: scale(1.1);
            border-color: var(--primary);
        }

        .monitor-toggle .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .monitor-panel {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 400px;
            max-height: 500px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            z-index: 999;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            display: none;
        }

        .monitor-panel.show {
            display: block;
        }

        .monitor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: linear-gradient(135deg, #1e293b, #334155);
            border-bottom: 1px solid var(--border);
        }

        .monitor-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .monitor-controls {
            display: flex;
            gap: 0.5rem;
        }

        .monitor-btn {
            padding: 0.4rem 0.8rem;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .monitor-btn:hover {
            border-color: var(--primary);
        }

        /* Stats */
        .monitor-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            padding: 0.75rem;
            background: var(--bg);
            border-bottom: 1px solid var(--border);
        }

        .stat-item {
            text-align: center;
            padding: 0.5rem;
        }

        .stat-num {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .stat-num.scripts { color: #8b5cf6; }
        .stat-num.eval { color: var(--danger); }
        .stat-num.fetch { color: #06b6d4; }
        .stat-num.dom { color: var(--warning); }

        .stat-name {
            font-size: 0.65rem;
            color: var(--text-muted);
        }

        /* Tabs */
        .monitor-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
        }

        .monitor-tab {
            flex: 1;
            padding: 0.6rem;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
        }

        .monitor-tab:hover {
            color: var(--text);
        }

        .monitor-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* Logs */
        .monitor-logs {
            max-height: 280px;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .monitor-logs::-webkit-scrollbar {
            width: 4px;
        }

        .monitor-logs::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 2px;
        }

        .log-item {
            padding: 0.6rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.75rem;
            font-family: 'Monaco', 'Consolas', monospace;
        }

        .log-item:last-child {
            border-bottom: none;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.25rem;
        }

        .log-tag {
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
            font-size: 0.65rem;
            font-weight: 600;
        }

        .log-tag.script { background: #8b5cf6; color: white; }
        .log-tag.eval { background: var(--danger); color: white; }
        .log-tag.function { background: #f97316; color: white; }
        .log-tag.fetch { background: #06b6d4; color: white; }
        .log-tag.xhr { background: #0ea5e9; color: white; }
        .log-tag.mutation { background: var(--warning); color: black; }
        .log-tag.worker { background: var(--success); color: white; }

        .log-time {
            color: var(--text-muted);
            font-size: 0.65rem;
        }

        .log-content {
            color: var(--text);
            word-break: break-all;
            line-height: 1.4;
        }

        .log-stack {
            color: var(--text-muted);
            font-size: 0.65rem;
            margin-top: 0.25rem;
        }

        .empty-logs {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            background: var(--success);
            color: white;
            border-radius: 10px;
            font-size: 0.9rem;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s;
            z-index: 2000;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.error {
            background: var(--danger);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="login-card">
            <!-- Logo -->
            <div class="logo">
                <div class="logo-icon">üè¶</div>
                <div class="logo-text">SecureBank</div>
                <div class="logo-subtitle">ÂÆâÂÖ®ÂèØ‰ø°ËµñÁöÑÁΩë‰∏äÈì∂Ë°å</div>
            </div>

            <h2>ÁôªÂΩïÊÇ®ÁöÑË¥¶Êà∑</h2>

            <!-- Login Form -->
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Áî®Êà∑Âêç / ÈÇÆÁÆ±</label>
                    <div class="input-wrapper">
                        <span class="input-icon">üë§</span>
                        <input 
                            type="text" 
                            class="form-input" 
                            id="username"
                            name="username"
                            placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÊàñÈÇÆÁÆ±"
                            autocomplete="username"
                        >
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ÂØÜÁ†Å</label>
                    <div class="input-wrapper">
                        <span class="input-icon">üîí</span>
                        <input 
                            type="password" 
                            class="form-input" 
                            id="password"
                            name="password"
                            placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å"
                            autocomplete="current-password"
                        >
                    </div>
                </div>

                <div class="form-checkbox">
                    <label class="checkbox-wrapper">
                        <input type="checkbox" id="remember" name="remember">
                        <span class="checkbox-label">ËÆ∞‰ΩèÊàë</span>
                    </label>
                    <a href="#" class="forgot-link">ÂøòËÆ∞ÂØÜÁ†ÅÔºü</a>
                </div>

                <button type="submit" class="btn-login">Áôª ÂΩï</button>
            </form>

            <!-- Divider -->
            <div class="divider">
                <div class="divider-line"></div>
                <span class="divider-text">Êàñ‰ΩøÁî®‰ª•‰∏ãÊñπÂºèÁôªÂΩï</span>
                <div class="divider-line"></div>
            </div>

            <!-- Social Login -->
            <div class="social-buttons">
                <button class="btn-social" data-provider="wechat" title="ÂæÆ‰ø°ÁôªÂΩï">üí¨</button>
                <button class="btn-social" data-provider="alipay" title="ÊîØ‰ªòÂÆùÁôªÂΩï">üí∞</button>
                <button class="btn-social" data-provider="google" title="GoogleÁôªÂΩï">üîç</button>
                <button class="btn-social" data-provider="apple" title="AppleÁôªÂΩï">üçé</button>
            </div>

            <!-- Register -->
            <div class="register-link">
                ËøòÊ≤°ÊúâË¥¶Êà∑Ôºü<a href="#">Á´ãÂç≥Ê≥®ÂÜå</a>
            </div>
        </div>
    </div>

    <!-- Monitor Toggle Button -->
    <div class="monitor-toggle" id="monitorToggle" title="Source Monitor">
        üî¨
        <span class="badge" id="totalBadge">0</span>
    </div>

    <!-- Monitor Panel -->
    <div class="monitor-panel" id="monitorPanel">
        <div class="monitor-header">
            <div class="monitor-title">
                <span class="status-dot"></span>
                Source Monitor
            </div>
            <div class="monitor-controls">
                <button class="monitor-btn" onclick="SourceMonitor.clearLogs()">Ê∏ÖÁ©∫</button>
                <button class="monitor-btn" onclick="SourceMonitor.exportLogs()">ÂØºÂá∫</button>
            </div>
        </div>

        <div class="monitor-stats">
            <div class="stat-item">
                <div class="stat-num scripts" id="statScripts">0</div>
                <div class="stat-name">ËÑöÊú¨</div>
            </div>
            <div class="stat-item">
                <div class="stat-num eval" id="statEval">0</div>
                <div class="stat-name">Eval</div>
            </div>
            <div class="stat-item">
                <div class="stat-num fetch" id="statFetch">0</div>
                <div class="stat-name">ËØ∑Ê±Ç</div>
            </div>
            <div class="stat-item">
                <div class="stat-num dom" id="statDOM">0</div>
                <div class="stat-name">DOM</div>
            </div>
        </div>

        <div class="monitor-tabs">
            <button class="monitor-tab active" data-tab="all">ÂÖ®ÈÉ®</button>
            <button class="monitor-tab" data-tab="scripts">ËÑöÊú¨</button>
            <button class="monitor-tab" data-tab="eval">Eval</button>
            <button class="monitor-tab" data-tab="fetch">ËØ∑Ê±Ç</button>
            <button class="monitor-tab" data-tab="dom">DOM</button>
        </div>

        <div class="monitor-logs" id="monitorLogs">
            <div class="empty-logs">Á≠âÂæÖÊçïËé∑...</div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        /**
         * ========================================
         * Source Monitor - ÁôªÂΩïÈ°µÈù¢Áâà
         * ========================================
         * 
         * ÁõëÊéßÂÜÖÂÆπ:
         * 1. ËÑöÊú¨Ê≥®ÂÖ• (createElement, document.write)
         * 2. Âä®ÊÄÅ‰ª£Á†ÅÊâßË°å (eval, Function)
         * 3. ÁΩëÁªúËØ∑Ê±Ç (fetch, XHR)
         * 4. DOM ÂèòÂåñ (MutationObserver)
         */

        const SourceMonitor = {
            stats: { scripts: 0, eval: 0, fetch: 0, dom: 0 },
            logs: [],
            currentTab: 'all',
            originals: {},

            init() {
                this.hookScriptCreation();
                this.hookEval();
                this.hookFunction();
                this.hookFetch();
                this.hookXHR();
                this.hookDOM();
                this.hookDocumentWrite();
                this.hookCDPInjection();
                this.bindUI();
                
                console.log('%cüî¨ Source Monitor Active', 'background: #3b82f6; color: white; padding: 6px 12px; border-radius: 4px;');
            },

            // Ê∑ªÂä†Êó•Âøó
            addLog(category, type, content, extra = {}) {
                const time = new Date().toLocaleTimeString('zh-CN', { 
                    hour12: false,
                    hour: '2-digit',
                    minute: '2-digit', 
                    second: '2-digit'
                });

                const entry = { time, category, type, content, ...extra, id: Date.now() };
                this.logs.unshift(entry);
                if (this.logs.length > 200) this.logs.pop();

                // Êõ¥Êñ∞ÁªüËÆ°
                if (category === 'scripts') this.stats.scripts++;
                else if (category === 'eval') this.stats.eval++;
                else if (category === 'fetch') this.stats.fetch++;
                else if (category === 'dom') this.stats.dom++;

                this.updateUI();
            },

            // Êõ¥Êñ∞ UI
            updateUI() {
                document.getElementById('statScripts').textContent = this.stats.scripts;
                document.getElementById('statEval').textContent = this.stats.eval;
                document.getElementById('statFetch').textContent = this.stats.fetch;
                document.getElementById('statDOM').textContent = this.stats.dom;

                const total = this.stats.scripts + this.stats.eval + this.stats.fetch + this.stats.dom;
                document.getElementById('totalBadge').textContent = total > 99 ? '99+' : total;

                this.renderLogs();
            },

            // Ê∏≤ÊüìÊó•Âøó
            renderLogs() {
                const container = document.getElementById('monitorLogs');
                let filtered = this.logs;

                if (this.currentTab !== 'all') {
                    filtered = this.logs.filter(log => log.category === this.currentTab);
                }

                if (filtered.length === 0) {
                    container.innerHTML = '<div class="empty-logs">ÊöÇÊó†Êó•Âøó</div>';
                    return;
                }

                container.innerHTML = filtered.slice(0, 50).map(log => `
                    <div class="log-item">
                        <div class="log-header">
                            <span class="log-tag ${log.type}">${log.type.toUpperCase()}</span>
                            <span class="log-time">${log.time}</span>
                        </div>
                        <div class="log-content">${this.escapeHtml(log.content)}</div>
                        ${log.stack ? `<div class="log-stack">${log.stack}</div>` : ''}
                    </div>
                `).join('');
            },

            escapeHtml(str) {
                if (typeof str !== 'string') str = String(str);
                return str
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .slice(0, 300) + (str.length > 300 ? '...' : '');
            },

            getStack() {
                try { throw new Error(); } catch (e) {
                    return e.stack.split('\n').slice(3, 5).join(' ‚Üê ').replace(/\s+/g, ' ').slice(0, 150);
                }
            },

            // ==================== Èí©Â≠êÂáΩÊï∞ ====================

            hookScriptCreation() {
                const self = this;
                const original = document.createElement.bind(document);
                this.originals.createElement = original;

                document.createElement = function(tagName, options) {
                    const el = original(tagName, options);
                    
                    if (tagName.toLowerCase() === 'script') {
                        self.addLog('scripts', 'script', 'ÂàõÂª∫ <script> ÂÖÉÁ¥†', { stack: self.getStack() });

                        // ÁõëÊéß src
                        let srcVal = '';
                        Object.defineProperty(el, 'src', {
                            get() { return srcVal; },
                            set(v) {
                                srcVal = v;
                                self.addLog('scripts', 'script', `ËÆæÁΩÆ src: ${v}`, { stack: self.getStack() });
                            }
                        });

                        // ÁõëÊéß textContent
                        let textVal = '';
                        Object.defineProperty(el, 'textContent', {
                            get() { return textVal; },
                            set(v) {
                                textVal = v;
                                if (v?.trim()) {
                                    self.addLog('scripts', 'script', `ÂÜÖËÅî‰ª£Á†Å: ${v.slice(0, 100)}...`, { stack: self.getStack() });
                                }
                            }
                        });
                    }
                    return el;
                };
            },

            hookEval() {
                const self = this;
                const original = window.eval;
                this.originals.eval = original;

                window.eval = function(code) {
                    self.addLog('eval', 'eval', `eval(): ${String(code).slice(0, 200)}`, { stack: self.getStack() });
                    return original.call(this, code);
                };
            },

            hookFunction() {
                const self = this;
                const Original = window.Function;
                this.originals.Function = Original;

                window.Function = function(...args) {
                    self.addLog('eval', 'function', `new Function(${args.join(', ').slice(0, 200)})`, { stack: self.getStack() });
                    return new Original(...args);
                };
                window.Function.prototype = Original.prototype;
            },

            hookFetch() {
                const self = this;
                const original = window.fetch;
                this.originals.fetch = original;

                window.fetch = function(input, init = {}) {
                    const url = typeof input === 'string' ? input : input?.url || input;
                    const method = init.method || 'GET';
                    self.addLog('fetch', 'fetch', `${method} ${url}`, { stack: self.getStack() });
                    return original.call(this, input, init);
                };
            },

            hookXHR() {
                const self = this;
                const Original = window.XMLHttpRequest;
                this.originals.XMLHttpRequest = Original;

                window.XMLHttpRequest = function() {
                    const xhr = new Original();
                    const originalOpen = xhr.open.bind(xhr);
                    
                    xhr.open = function(method, url, ...args) {
                        self.addLog('fetch', 'xhr', `${method} ${url}`, { stack: self.getStack() });
                        return originalOpen(method, url, ...args);
                    };
                    return xhr;
                };
            },

            hookDOM() {
                const self = this;
                
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach(m => {
                        m.addedNodes.forEach(node => {
                            if (node.nodeType === 1) {
                                if (node.tagName === 'SCRIPT') {
                                    self.addLog('dom', 'mutation', `DOMÊ∑ªÂä† <script>: ${node.src || 'ÂÜÖËÅî'}`);
                                } else if (node.tagName === 'IFRAME') {
                                    self.addLog('dom', 'mutation', `DOMÊ∑ªÂä† <iframe>: ${node.src || 'blank'}`);
                                }
                            }
                        });

                        if (m.type === 'attributes' && m.attributeName?.startsWith('on')) {
                            self.addLog('dom', 'mutation', `Â±ûÊÄßÂèòÂåñ: ${m.target.tagName}.${m.attributeName}`);
                        }
                    });
                });

                observer.observe(document.documentElement, {
                    childList: true,
                    subtree: true,
                    attributes: true,
                    attributeFilter: ['src', 'href', 'onclick', 'onload', 'onerror']
                });
            },

            hookDocumentWrite() {
                const self = this;
                const original = document.write.bind(document);
                this.originals.write = original;

                document.write = function(markup) {
                    if (markup?.includes('<script')) {
                        self.addLog('scripts', 'script', `document.write: ${markup.slice(0, 150)}`, { stack: self.getStack() });
                    }
                    return original(markup);
                };
            },

            // ÁõëÊéß CDP/Puppeteer Ê≥®ÂÖ• (page.evaluate, page.addScriptTag Á≠â)
            hookCDPInjection() {
                const self = this;

                // 1. ÁõëÊéß Runtime.evaluate ÈÄöËøáÊ£ÄÊµãÊâßË°å‰∏ä‰∏ãÊñá
                // CDP Ê≥®ÂÖ•ÁöÑ‰ª£Á†ÅÈÄöÂ∏∏ÊúâÁâπÊÆäÁöÑË∞ÉÁî®Ê†àÁâπÂæÅ
                const detectCDPStack = () => {
                    try { throw new Error(); } catch (e) {
                        const stack = e.stack || '';
                        // Puppeteer/CDP Ê≥®ÂÖ•ÁöÑÁâπÂæÅ
                        if (stack.includes('__puppeteer_evaluation_script__') ||
                            stack.includes('pptr:evaluate') ||
                            stack.includes('Runtime.evaluate') ||
                            stack.includes('ExecutionContext') ||
                            stack.includes('_onTimeout') && stack.includes('.asar')) {
                            return true;
                        }
                    }
                    return false;
                };

                // 2. ÁõëÊéß setTimeout/setInterval (CDP Â∏∏Áî®Ëøô‰∫õÊâßË°å‰ª£Á†Å)
                const originalSetTimeout = window.setTimeout;
                const originalSetInterval = window.setInterval;
                this.originals.setTimeout = originalSetTimeout;
                this.originals.setInterval = originalSetInterval;

                window.setTimeout = function(fn, delay, ...args) {
                    if (typeof fn === 'string') {
                        self.addLog('eval', 'eval', `setTimeout(string): ${fn.slice(0, 150)}`, { stack: self.getStack() });
                    } else if (typeof fn === 'function') {
                        const stack = self.getStack();
                        if (stack.includes('pptr') || stack.includes('.asar') || stack.includes('evaluate')) {
                            self.addLog('eval', 'eval', `setTimeout (CDPÊ≥®ÂÖ•Ê£ÄÊµã): ${fn.toString().slice(0, 100)}`, { stack });
                        }
                    }
                    return originalSetTimeout.call(this, fn, delay, ...args);
                };

                window.setInterval = function(fn, delay, ...args) {
                    if (typeof fn === 'string') {
                        self.addLog('eval', 'eval', `setInterval(string): ${fn.slice(0, 150)}`, { stack: self.getStack() });
                    }
                    return originalSetInterval.call(this, fn, delay, ...args);
                };

                // 3. ÁõëÊéß Function.prototype.call/apply (CDP ÁªèÂ∏∏Áî®Ëøô‰∫õ)
                const originalCall = Function.prototype.call;
                const originalApply = Function.prototype.apply;

                // 4. Ê£ÄÊµã window ‰∏äÊñ∞Â¢ûÁöÑÂÖ®Â±ÄÂèòÈáè (CDP Ê≥®ÂÖ•Â∏∏Ê∑ªÂä†)
                const knownGlobals = new Set(Object.keys(window));
                setInterval(() => {
                    Object.keys(window).forEach(key => {
                        if (!knownGlobals.has(key) && !key.startsWith('__SOURCE')) {
                            knownGlobals.add(key);
                            const value = window[key];
                            const type = typeof value;
                            if (type === 'function' || type === 'object') {
                                self.addLog('eval', 'eval', `Êñ∞Â¢ûÂÖ®Â±ÄÂèòÈáè: window.${key} (${type})`, {});
                            }
                        }
                    });
                }, 1000);

                // 5. ÁõëÊéß Object.defineProperty (CDP Áî®Êù•‰øÆÊîπÂéüÂûã)
                const originalDefineProperty = Object.defineProperty;
                this.originals.defineProperty = originalDefineProperty;

                Object.defineProperty = function(obj, prop, descriptor) {
                    // Ê£ÄÊµãÂØπÂéüÁîüÂØπË±°ÁöÑ‰øÆÊîπ
                    if (obj === window || obj === document || 
                        obj === Element.prototype || obj === Node.prototype ||
                        obj === HTMLElement.prototype) {
                        self.addLog('eval', 'eval', `Object.defineProperty: ${obj.constructor?.name || 'object'}.${String(prop)}`, { 
                            stack: self.getStack() 
                        });
                    }
                    return originalDefineProperty.call(this, obj, prop, descriptor);
                };

                // 6. ÁõëÊéß Proxy ÂàõÂª∫ (Ëá™Âä®ÂåñÂ∑•ÂÖ∑Â∏∏Áî®)
                const OriginalProxy = window.Proxy;
                if (OriginalProxy) {
                    window.Proxy = function(target, handler) {
                        self.addLog('eval', 'eval', `new Proxy() ÂàõÂª∫`, { stack: self.getStack() });
                        return new OriginalProxy(target, handler);
                    };
                }

                // 7. ÂÆöÊúüÊ£ÄÊü•ÊòØÂê¶Êúâ CDP ËøûÊé•ÁâπÂæÅ
                this.checkCDPConnection();
            },

            // Ê£ÄÊµã CDP ËøûÊé•ÁâπÂæÅ
            checkCDPConnection() {
                const self = this;
                
                // Ê£ÄÊµã webdriver Â±ûÊÄß
                if (navigator.webdriver) {
                    self.addLog('eval', 'eval', 'Ê£ÄÊµãÂà∞ navigator.webdriver = true (Ëá™Âä®ÂåñÁéØÂ¢É)', {});
                }

                // Ê£ÄÊµã CDP ÁâπÊúâÁöÑÂ±ûÊÄß
                const cdpSigns = [
                    'cdc_adoQpoasnfa76pfcZLmcfl_Array',
                    'cdc_adoQpoasnfa76pfcZLmcfl_Promise', 
                    'cdc_adoQpoasnfa76pfcZLmcfl_Symbol',
                    '__webdriver_evaluate',
                    '__selenium_evaluate',
                    '__webdriver_script_function',
                    '__webdriver_script_func',
                    '__webdriver_script_fn',
                    '__fxdriver_evaluate',
                    '__driver_unwrapped',
                    '__webdriver_unwrapped',
                    '__driver_evaluate',
                    '__selenium_unwrapped',
                    '__fxdriver_unwrapped',
                    '_Selenium_IDE_Recorder',
                    '_selenium',
                    'calledSelenium',
                    '$chrome_asyncScriptInfo',
                    '$cdc_asdjflasutopfhvcZLmcfl_',
                    '__$webdriverAsyncExecutor'
                ];

                cdpSigns.forEach(sign => {
                    if (sign in window || sign in document) {
                        self.addLog('eval', 'eval', `Ê£ÄÊµãÂà∞Ëá™Âä®ÂåñÁâπÂæÅ: ${sign}`, {});
                    }
                });

                // Ê£ÄÊµã Chrome DevTools Protocol Ê≥®ÂÖ•ÁöÑÂáΩÊï∞
                if (window.chrome && window.chrome.csi) {
                    // Ê≠£Â∏∏ÁöÑ chrome.csi Ê£ÄÊü•
                }
            },

            // ==================== UI ÁªëÂÆö ====================

            bindUI() {
                // Toggle panel
                document.getElementById('monitorToggle').addEventListener('click', () => {
                    document.getElementById('monitorPanel').classList.toggle('show');
                });

                // Tabs
                document.querySelectorAll('.monitor-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        document.querySelectorAll('.monitor-tab').forEach(t => t.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentTab = e.target.dataset.tab;
                        this.renderLogs();
                    });
                });
            },

            clearLogs() {
                this.logs = [];
                this.stats = { scripts: 0, eval: 0, fetch: 0, dom: 0 };
                this.updateUI();
            },

            exportLogs() {
                const data = { timestamp: new Date().toISOString(), stats: this.stats, logs: this.logs };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `source-log-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }
        };

        // ==================== ÁôªÂΩïË°®ÂçïÂ§ÑÁêÜ ====================
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (!username || !password) {
                showToast('ËØ∑Â°´ÂÜôÁî®Êà∑ÂêçÂíåÂØÜÁ†Å', 'error');
                return;
            }

            // Ê®°ÊãüÁôªÂΩïËØ∑Ê±Ç
            fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            }).catch(() => {
                // ÊºîÁ§∫Áî®ÔºåÂøΩÁï•ÈîôËØØ
            });

            showToast('ÁôªÂΩïËØ∑Ê±ÇÂ∑≤ÂèëÈÄÅ (ÊºîÁ§∫)');
        });

        // Á§æ‰∫§ÁôªÂΩï
        document.querySelectorAll('.btn-social').forEach(btn => {
            btn.addEventListener('click', function() {
                const provider = this.dataset.provider;
                showToast(`${provider} ÁôªÂΩï (ÊºîÁ§∫)`);
            });
        });

        function showToast(msg, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.className = 'toast show' + (type === 'error' ? ' error' : '');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }

        // ÂàùÂßãÂåñ
        SourceMonitor.init();

        // Êö¥Èú≤ÂÖ®Â±ÄÊé•Âè£
        window.__SOURCE_MONITOR__ = {
            getStats: () => SourceMonitor.stats,
            getLogs: () => SourceMonitor.logs,
            export: () => SourceMonitor.exportLogs()
        };
    </script>
</body>
</html>
